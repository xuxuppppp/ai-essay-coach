<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å¯«ä½œæ•™ç·´ - åœ‹ä¸­æœƒè€ƒæ¨¡æ“¬ç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #4a90e2; --bg: #f5f7fa; --text: #333; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 300px 1fr 350px; gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { border-left: 5px solid var(--primary); padding-left: 10px; font-size: 1.2rem; }
        textarea { width: 100%; height: 400px; border: 1px solid #ddd; border-radius: 8px; padding: 15px; font-size: 1rem; resize: none; box-sizing: border-box; }
        .btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 10px; transition: 0.3s; }
        .btn:hover { background: #357abd; }
        .btn-secondary { background: #6c757d; }
        #wordCount { text-align: right; font-size: 0.8rem; color: #666; margin-top: 5px; }
        .radar-container { width: 100%; height: 250px; }
        #feedbackArea { font-size: 0.95rem; line-height: 1.6; color: #444; margin-top: 15px; }
        .loading { display: none; text-align: center; color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>

<h1 style="text-align:center;">ğŸ“ AI å¯«ä½œæ•™ç·´ï¼šæœƒè€ƒä½œæ–‡è¨ºæ–·ç³»çµ±</h1>

<div class="container">
    <div class="card">
        <h2>ğŸ“Œ ä»Šæ—¥æŒ‘æˆ°é¡Œç›®</h2>
        <div id="topicBox">
            <h3 id="topicTitle">é»æ“Šä¸‹æ–¹æŒ‰éˆ•å‡ºé¡Œ</h3>
            <p id="topicDesc">æº–å‚™å¥½å¾Œï¼Œè«‹åœ¨ä¸­é–“å€åŸŸé–‹å§‹æ’°å¯«ã€‚</p>
        </div>
        <button class="btn btn-secondary" onclick="getRandomTopic()">ğŸ² éš¨æ©Ÿæ›ä¸€é¡Œ</button>
    </div>

    <div class="card">
        <h2>âœï¸ å­¸ç”Ÿä½œç­”å€</h2>
        <textarea id="essayInput" placeholder="è«‹åœ¨æ­¤è¼¸å…¥æ‚¨çš„ä½œæ–‡å…§å®¹..."></textarea>
        <div id="wordCount">ç›®å‰å­—æ•¸ï¼š0 å­—</div>
        <button class="btn" onclick="submitToAI()">ğŸš€ é€å‡º AI è©•æ”¹</button>
        <div id="loadingStatus" class="loading">AI è€å¸«æ­£åœ¨é–±å·ä¸­ï¼Œè«‹ç¨å€™...</div>
    </div>

    <div class="card">
        <h2>ğŸ“Š è¨ºæ–·å ±å‘Š</h2>
        <div class="radar-container">
            <canvas id="scoreChart"></canvas>
        </div>
        <div id="feedbackArea">
            <p>å®Œæˆä½œæ–‡ä¸¦é€å‡ºå¾Œï¼Œé€™è£¡å°‡é¡¯ç¤ºè©³ç´°çš„å›é¥‹å»ºè­°ã€‚</p>
        </div>
    </div>
</div>

<script>
   // --- 1. å¯«æ­»é¡Œåº«ç²å–åŠŸèƒ½ (ä¸é€£å‹• Make) ---
    async function getRandomTopic() {
        // ç›´æ¥åœ¨å‰ç«¯å»ºç«‹é¡Œåº«æ¸…å–®
        const topics = [
            {
                year: "113å¹´æœƒè€ƒ",
                title: "åœ¨é€™æ¨£çš„æ¨™ç±¤ä¸‹",
                description: "ç”Ÿæ´»ä¸­æœ‰å„ç¨®æ¨™ç±¤ï¼Œæ¨™ç±¤æœ‰æ™‚æ˜¯èº«åˆ†ï¼Œæœ‰æ™‚æ˜¯åˆ»æ¿å°è±¡ã€‚è«‹åˆ†äº«ä½ çš„è§€å¯Ÿèˆ‡æ€è€ƒã€‚"
            },
            {
                year: "112å¹´æœƒè€ƒ",
                title: "ä¸å¿…ç”±æˆ‘ï¼Œç”±æˆ‘å€‘",
                description: "æœ‰äº›äº‹ä¸€äººé›£æˆï¼Œçœ¾äººé½Šå¿ƒæ–¹æˆã€‚è«‹å¯«ä¸‹ä½ èˆ‡åœ˜éšŠåˆä½œå…‹æœæŒ‘æˆ°çš„ç¶“é©—ã€‚"
            },
            {
                year: "111å¹´æœƒè€ƒ",
                title: "å¤šåšå¤šå¾—ï¼Ÿ",
                description: "å‚³çµ±è§€å¿µèªç‚ºä»˜å‡ºæ„ˆå¤šæ”¶ç©«æ„ˆå¤šï¼Œä½†åœ¨ç¾ä»£ç¤¾æœƒæ˜¯å¦ä¾ç„¶å¦‚æ­¤ï¼Ÿè«‹è«–è¿°ä½ çš„è¦‹è§£ã€‚"
            },
            {
                year: "110å¹´æœƒè€ƒ",
                title: "æœªæˆåŠŸçš„å˜—è©¦",
                description: "äººç”Ÿä¸­ä¸¦éæ‰€æœ‰å˜—è©¦éƒ½èƒ½æ›ä¾†æˆåŠŸï¼Œä½†é€™äº›éç¨‹å»æœ‰å…¶æ„ç¾©ã€‚è«‹åˆ†äº«ä½ çš„æ•…äº‹ã€‚"
            },
            {
                year: "109å¹´æœƒè€ƒ",
                title: "æˆ‘æƒ³é–‹è¨­ä¸€å®¶é€™æ¨£çš„åº—",
                description: "å¦‚æœå¯ä»¥è‡ªå‰µåº—é‹ªï¼Œä½ æƒ³è³£ä»€éº¼ï¼Ÿå‚³éä»€éº¼ç†å¿µï¼Ÿè«‹æè¿°ä½ çš„è—åœ–ã€‚"
            }
        ];
        
        try {
            document.getElementById('topicTitle').innerText = "æ­£åœ¨éš¨æ©ŸæŠ½é¸é¡Œç›®...";
            
            // å»¶é² 0.5 ç§’æ¨¡æ“¬é›²ç«¯è®€å–æ„Ÿï¼Œè®“å±•ç¤ºæ›´çœŸå¯¦
            setTimeout(() => {
                const selected = topics[Math.floor(Math.random() * topics.length)];
                displayTopic(selected);
            }, 500);
            
        } catch (err) {
            console.error("é¸é¡ŒéŒ¯èª¤:", err);
            document.getElementById('topicTitle').innerText = "é¸é¡Œå¤±æ•—";
        }
    }

    function displayTopic(selected) {
        document.getElementById('topicTitle').innerText = `${selected.title} (${selected.year})`;
        document.getElementById('topicDesc').innerText = selected.description;
    }

    // --- 2. ä»‹é¢äº’å‹•åŠŸèƒ½ ---
    // å­—æ•¸çµ±è¨ˆ
    document.getElementById('essayInput').addEventListener('input', function() {
        document.getElementById('wordCount').innerText = `ç›®å‰å­—æ•¸ï¼š${this.value.length} å­—`;
    });

    // åˆå§‹åŒ–é›·é”åœ–
    let ctx = document.getElementById('scoreChart').getContext('2d');
    let scoreChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['ç«‹æ„å–æ', 'çµæ§‹çµ„ç¹”', 'é£è©é€ å¥', 'éŒ¯åˆ¥å­—èˆ‡æ¨™é»'],
            datasets: [{ 
                label: 'è©•åˆ†åˆ†æ•¸', 
                data: [0, 0, 0, 0], 
                backgroundColor: 'rgba(74, 144, 226, 0.2)', 
                borderColor: 'rgba(74, 144, 226, 1)',
                pointBackgroundColor: 'rgba(74, 144, 226, 1)'
            }]
        },
        options: { 
            scales: { 
                r: { 
                    min: 0, 
                    max: 6, 
                    ticks: { stepSize: 1, display: false },
                    grid: { color: '#ddd' }
                } 
            } 
        }
    });

    // --- 3. AI è©•æ”¹é€å‡ºåŠŸèƒ½ ---
    async function submitToAI() {
        const essay = document.getElementById('essayInput').value;
        const topic = document.getElementById('topicTitle').innerText;
        
        if (!essay || essay.length < 10) return alert("è«‹è¼¸å…¥è¶³å¤ é•·åº¦çš„ä½œæ–‡å†é€å‡ºï¼");

        document.getElementById('loadingStatus').style.display = 'block';

        // é€™æ˜¯æ‚¨çš„è©•åˆ† Webhook URL
        const gradingWebhookURL = "https://hook.eu2.make.com/fum3xa9brgtrwdu6oy898on7l2saphon"; 
        
        try {
            const response = await fetch(gradingWebhookURL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ topic, essay, student: "é«”é©—è€…" })
            });

            if (!response.ok) throw new Error("ç¶²è·¯è«‹æ±‚å¤±æ•—");

            const data = await response.json();
            
            // æ›´æ–°é›·é”åœ–
            scoreChart.data.datasets[0].data = [data.score1, data.score2, data.score3, data.score4];
            scoreChart.update();

            // æ›´æ–°è©•èªå€åŸŸï¼Œç¢ºä¿é¡¯ç¤ºæ­£å‘å›é¥‹ [cite: 38, 136]
            document.getElementById('feedbackArea').innerHTML = `
                <div style="font-weight:bold; color:var(--primary); font-size: 1.2rem;">
                    ç¸½ç´šåˆ†ï¼š${data.totalGrade} ç´š
                </div>
                <hr>
                <p><strong>AI è€å¸«çš„å»ºè­°ï¼š</strong></p>
                <p>${data.feedback}</p>
            `;
        } catch (err) {
            alert("é€£ç·šå¤±æ•—ï¼Œè«‹ç¢ºä¿ Make æµç¨‹å·²é–‹å•Ÿ (ON) æˆ–é»æ“Šäº† Run Onceã€‚");
        } finally {
            document.getElementById('loadingStatus').style.display = 'none';
        }
    }
</script>
</body>
</html>